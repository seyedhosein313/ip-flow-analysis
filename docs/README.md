<div dir="rtl">

## مرور پروژه

هدف این پروژه، تحلیل جریان‌های ترافیک شبکه IP برای پیش‌بینی پروتکل لایه کاربردی (برنامه‌های خاص) مانند فیسبوک، یوتیوب و اینستاگرام است.
مجموعه‌داده را می‌توانید از [اینجا](https://www.kaggle.com/jsrojas/ip-network-traffic-flows-labeled-with-87-apps) دریافت کنید. این مجموعه‌داده شامل ۸۷ ویژگی است. هر نمونه حاوی اطلاعات یک جریان IP تولید شده توسط دستگاه شبکه است، از جمله: آدرس‌های IP مبدأ و مقصد، پورت‌ها، زمان‌های بین ورودی و پروتکل لایه ۷ (برنامه) مورد استفاده در جریان که به عنوان کلاس پیش‌بینی‌پذیر هدف ماست.

## بیان مسئله

تعداد تهدیدات سایبری به طور مداوم در حال افزایش است. این تهدیدات پیچیده‌تر شده‌اند، به طور دقیق هدف‌گیری می‌شوند و می‌توانند از راه‌حل‌های امنیتی سنتی پیرامون شبکه‌های داده عبور کنند. تحلیل جریان‌های IP بخش ضروری اندازه‌گیری ترافیک برای امنیت سایبری است، زیرا جریان‌های IP تنها اطلاعات هدر بسته‌ها را جمع‌آوری می‌کنند.

## انگیزه پژوهش

با توجه به اینکه اکثر مجموعه‌داده‌های طبقه‌بندی ترافیک شبکه صرفاً برای شناسایی نوع برنامه (مانند WWW، DNS، FTP، P2P، Telnet و غیره) طراحی شده‌اند، این مجموعه‌داده با تولید مدل‌های یادگیری ماشین قادر به تشخیص برنامه‌های خاص مانند فیسبوک، یوتیوب، اینستاگرام و غیره از آمار جریان‌های IP (فعلاً ۷۵ برنامه) گامی فراتر گذاشته است.
## معیارهای ارزیابی


از دقت (accuracy) به عنوان معیار ارزیابی برای طبقه‌بندی چندکلاسه استفاده خواهیم کرد. این معیار بسامد تطابق کلاس‌های پیش‌بینی شده با برچسب‌های واقعی را محاسبه می‌کند.


## تحلیل اکتشافی


مجموعه‌داده شامل ۳,۵۷۷,۲۹۶ سطر و ۸۷ ستون است


**پیش‌نمایش مجموعه‌داده**

</div>

| Flow.ID                             | Source.IP   | Source.Port | Destination.IP | Destination.Port | Protocol | Timestamp          | Flow.Duration | Total.Fwd.Packets | Total.Backward.Packets | Total.Length.of.Fwd.Packets | Total.Length.of.Bwd.Packets | Fwd.Packet.Length.Max | Fwd.Packet.Length.Min | Fwd.Packet.Length.Mean | Fwd.Packet.Length.Std | Bwd.Packet.Length.Max | Bwd.Packet.Length.Min | Bwd.Packet.Length.Mean | Bwd.Packet.Length.Std | Flow.Bytes.s | Flow.Packets.s | Flow.IAT.Mean | Flow.IAT.Std | Flow.IAT.Max | Flow.IAT.Min | Fwd.IAT.Total | Fwd.IAT.Mean | Fwd.IAT.Std | Fwd.IAT.Max | Fwd.IAT.Min | Bwd.IAT.Total | Bwd.IAT.Mean | Bwd.IAT.Std | Bwd.IAT.Max | Bwd.IAT.Min | Fwd.PSH.Flags | Bwd.PSH.Flags | Fwd.URG.Flags | Bwd.URG.Flags | Fwd.Header.Length | Bwd.Header.Length | Fwd.Packets.s | Bwd.Packets.s | Min.Packet.Length | Max.Packet.Length | Packet.Length.Mean | Packet.Length.Std | Packet.Length.Variance | FIN.Flag.Count | SYN.Flag.Count | RST.Flag.Count | PSH.Flag.Count | ACK.Flag.Count | URG.Flag.Count | CWE.Flag.Count | ECE.Flag.Count | Down.Up.Ratio | Average.Packet.Size | Avg.Fwd.Segment.Size | Avg.Bwd.Segment.Size | Fwd.Header.Length.1 | Fwd.Avg.Bytes.Bulk | Fwd.Avg.Packets.Bulk | Fwd.Avg.Bulk.Rate | Bwd.Avg.Bytes.Bulk | Bwd.Avg.Packets.Bulk | Bwd.Avg.Bulk.Rate | Subflow.Fwd.Packets | Subflow.Fwd.Bytes | Subflow.Bwd.Packets | Subflow.Bwd.Bytes | Init_Win_bytes_forward | Init_Win_bytes_backward | act_data_pkt_fwd | min_seg_size_forward | Active.Mean | Active.Std | Active.Max | Active.Min | Idle.Mean | Idle.Std | Idle.Max | Idle.Min | Label  | L7Protocol | ProtocolName |
|-------------------------------------|-------------|-------------|----------------|------------------|----------|--------------------|---------------|-------------------|------------------------|-----------------------------|-----------------------------|-----------------------|-----------------------|------------------------|-----------------------|-----------------------|-----------------------|------------------------|-----------------------|--------------|----------------|---------------|--------------|--------------|--------------|---------------|--------------|-------------|-------------|-------------|---------------|--------------|-------------|-------------|-------------|---------------|---------------|---------------|---------------|-------------------|-------------------|---------------|---------------|-------------------|-------------------|--------------------|-------------------|------------------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|---------------|---------------------|----------------------|----------------------|---------------------|--------------------|----------------------|-------------------|--------------------|----------------------|-------------------|---------------------|-------------------|---------------------|-------------------|------------------------|-------------------------|------------------|----------------------|-------------|------------|------------|------------|-----------|----------|----------|----------|--------|------------|--------------|
| 172.19.1.46-10.200.7.7-52422-3128-6 | 172.19.1.46 | 52422       | 10.200.7.7     | 3128             | 6        | 26/04/201711:11:17 | 45523         | 22                | 55                     | 132                         | 110414.0                    | 6                     | 6                     | 6.000000               | 0.000000              | 4380                  | 1187                  | 2007.527273            | 768.481689            | 2.428355e+06 | 1.691453e+03   | 598.986842    | 816.061346   | 3880.0       | 1            | 45523.0       | 2167.761905  | 1319.384512 | 5988.0      | 698.0       | 41178.0       | 762.555556   | 1230.348220 | 5133.0      | 1.0         | 0             | 0             | 0             | 0             | 440               | 1100              | 4.832722e+02  | 1208.180480   | 6                 | 4380              | 1417.333333        | 1121.579194       | 1.257940e+06           | 0              | 0              | 0              | 0              | 1              | 0              | 0              | 0              | 2             | 1435.74026          | 6.000000             | 2007.527273          | 440                 | 0                  | 0                    | 0                 | 0                  | 0                    | 0                 | 22                  | 132               | 55                  | 110414            | 256                    | 490                     | 21               | 20                   | 0.0         | 0.0        | 0.0        | 0.0        | 0.0  Data Preprocessing     | 0.0      | 0.0      | 0.0      | BENIGN | 131        | HTTP_PROXY   |

<div dir="rtl">

تعداد مقادیر null در مجموعه‌داده صفر است


![number of flows per connection](https://raw.githubusercontent.com/MohammadA7/ip-flow-analysis/master/docs/number-of-flows-per-connection.png)


می‌بینیم که برخی ارتباطات با حجم بالایی از جریان‌ها وجود دارند


نمودار زیر ۱۰ برنامه برتر در مجموعه‌داده را نشان می‌دهد:

![top-10-applications](https://raw.githubusercontent.com/MohammadA7/ip-flow-analysis/master/docs/top-10-applications.png)

## پیش‌پردازش داده‌ها

جریان‌ها را بر اساس ارتباط تجمیع نمی‌کنیم (شاید در بهبودهای آینده) و هر جریان را جداگانه پردازش می‌کنیم


ستون‌های حذفی - دلیل حذف
* **Flow.ID** - صرفاً یک شناسه ارتباطی است
* **Source.IP** - صرفاً یک شناسه ارتباطی است
* **Source.Port** - پورت‌ها می‌توانند برای شناسایی پروتکل‌ها مفید باشند اما به دلیل باز شدن پورت‌های پویا در سمت کلاینت ممکن است گمراه‌کننده باشند (شاید در بهبودهای آینده)
* **Destination.IP** صرفاً یک شناسه ارتباطی است
* **Destination.Port** - پورت‌ها می‌توانند برای شناسایی پروتکل‌ها مفید باشند اما به دلیل باز شدن پورت‌های پویا در سمت کلاینت ممکن است گمراه‌کننده باشند (شاید در بهبودهای آینده)
* **Timestamp** - در شناسایی جریان‌های منفرد مفید نخواهد بود
* **Label** - فقط حاوی یک مقدار واحد است

داده‌ها به X و Y تقسیم می‌شوند:

X شامل تمام ویژگی‌ها به جز نام.پروتکل و پروتکل.لایه ۷
Y شامل متغیرهای مصنوعی استخراج شده از نام.پروتکل

سپس داده‌ها با نسبت آزمون ۰.۲۵ به آموزش و آزمون تقسیم می‌شوند


در نهایت [StandardScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html) روی داده‌ها اعمال می‌شود:
</div>

```
scale = StandardScaler()
# استانداردسازی ویژگی‌ها با حذف میانگین و مقیاس‌دهی به واریانس واحد
X_train = scale.fit_transform(X_train)
X_test = scale.transform(X_test)
```

<div dir="rtl">

## مدل‌سازی داده‌ها

از مدل یادگیری عمیق استفاده می‌کنیم زیرا دقت بهتری ارائه می‌دهد. مشکل اکثر الگوریتم‌های یادگیری ماشین عدم پشتیبانی از پردازش دسته‌ای و مصرف زمان زیاد است. با وجود ۳۲ گیگابایت حافظه RAM، بارها با خطای MemoryError و خاتمه فرآیند مواجه شدم. همچنین مدل‌های یادگیری ماشین نیازمند متخصصان حوزه‌ای باتجربه‌تر هستند.


الگوریتم **OneVsRestClassifier(LinearSVC())** را آزمایش کردم که دقت ۴۵٪ داشت
ویژگی‌های مدل نهایی
* لایه ورودی با ۷۸ بعد (تعداد ویژگی‌ها)
* ۳ لایه پنهان با تابع فعال‌ساز ReLU
* Dropout ۲۵٪ بین هر لایه
* تابع زیان آنتروپی متقاطع دسته‌ای
* بهینه‌ساز: گرادیان کاهشی تصادفی با نرخ یادگیری ۰.۰۱، مومنتوم ۰.۵ و کاهش ۱e-6
* دقت به عنوان معیار سنجش
* لایه خروجی با ۷۸ بعد (تعداد کلاس‌ها)

</div>

```
model = Sequential()

model.add(Dense(512, activation='relu', input_dim=78))
model.add(Dropout(0.25))
model.add(Dense(256, activation='relu'))
model.add(Dropout(0.25))
model.add(Dense(128, activation='relu'))
model.add(Dropout(0.25))
model.add(Dense(78, activation='softmax'))

# Note that we use a “softmax” activation 
# function in the output layer. This is to ensure 
# the output values are in the range of 0 and 1 
# and the max will be the predicted class.

sgd = SGD(lr=0.01, decay=1e-6, momentum=0.5, nesterov=True)

model.compile(loss='categorical_crossentropy',
              optimizer=sgd,
              metrics=['accuracy'])
```

<div dir="rtl">

آموزش مدل با ۳۰ دوره (epoch) و اندازه دسته ۱۲۸ انجام شد


## ارزیابی نتایج

میزان زیان آزمون: ۱.۰۵۱۷۶۲۷۸۲۳۶۶۲۶۴۵
دقت آزمون: ۰.۶۶۳۱۶۷۹۳۴۶۶۵۳۶۶۲

نمونه‌هایی از پیش‌بینی‌ها

![Predection for HTTP_PROXY](https://raw.githubusercontent.com/MohammadA7/ip-flow-analysis/master/docs/prediction-for-HTTP_PROXY.png)
![Predection for SSL](https://raw.githubusercontent.com/MohammadA7/ip-flow-analysis/master/docs/prediction-for-SSL.png)

در نمونه‌های طبقه‌بندی فوق مشاهده می‌کنیم که مدل همیشه دقیق نیست و نیاز به بهبود دارد.


یادگیری عمیق عملکرد بهتری داشت احتمالاً به این دلیل که می‌تواند الگوهای عمیق‌تری در داده‌ها شناسایی کند که روش‌های سنتی یادگیری ماشین قادر به تشخیص آن‌ها نبودند.


## نتیجه‌گیری

این تحلیل نشان می‌دهد که می‌توانیم برنامه جریان‌های IP را با دقت ۶۶٪ در طبقه‌بندی چندکلاسه با ۷۸ کلاس شناسایی کنیم که نتیجه بدی نیست.


مجموعه‌داده حاوی ۳,۵۷۷,۲۹۶ رکورد است که آموزش با الگوریتم‌های فاقد قابلیت پردازش دسته‌ای دشوار است.


### بهبودهای آتی


می‌توان مدل را با روش‌های زیر ارتقا داد 
* استفاده از ویژگی‌های بیشتری که حذف شدند
* استخراج ویژگی‌های جدید مانند (جریان برای ترافیک ورودی است یا خروجی؟ پورت ممتاز است یا خیر؟)
* تجمیع جریان‌ها بر اساس ارتباط

## سپاس‌گزاری

از خوان سباستین رخاس (Juan Sebastián Rojas) و دانشگاه دل کائوکا (Universidad Del Cauca) برای ارائه این مجموعه‌داده تشکر می‌کنم.

